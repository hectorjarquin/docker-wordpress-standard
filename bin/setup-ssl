#!/bin/bash
set -a
source .env

cd ./config/nginx/ssl || exit
# ensure mkcert is executable
chmod +x ./mkcert-v1.4.3-linux-amd64 2>/dev/null || true
# generate ssl certs
./mkcert-v1.4.3-linux-amd64 "${APP_DOMAIN}"

cd ..
# replace server name and certificate paths for the custom domain
# handles both fresh installs (mysite.local) and re-runs (any *.local domain)
sed -i -E "s/[a-zA-Z0-9_-]+\.local/${APP_DOMAIN}/g" ./conf.d/default.conf
